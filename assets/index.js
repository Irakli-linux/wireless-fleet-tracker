webpackJsonp([0],{126:function(e,n,i){"use strict";var l=i(0);e.exports=function(e){function n(n){a.list("vehicle-"+n+"-data").then(function(i){i.getItems({limit:100}).then(function(i){console.info("items arrived",n,i.items.length),o[n].driving_data=i.items.map(function(i){return i.data.value.id=i.index,e.onVehicleData(o[n],i.data.value),i.data.value})}),i.on("itemAdded",function(i){console.info("itemAdded",n,i),i.data.value.id=i.index,o[n].driving_data.push(i.data.value),e.onVehicleData(o[n],i.data.value)})})}var a,t,s=i(1),d=i(169).Client,c="username=trump&pincode=928462",o={};return{vehicles:o,updateToken:function(e){var n=this;return s.get("/authenticate?"+c,function(i){i.success?(console.log("token updated:",i),t=i.token,e&&e(t),a.updateToken(t),setTimeout(n.updateToken.bind(n),1e3*i.ttl*.96)):console.error("failed to authenticate the user: ",i.error)}).fail(function(e,i,l){console.error("failed to send authentication request:",i,l),setTimeout(n.updateToken.bind(n),1e4)})},refreshVehicleList:function(){s.get("/fleetmanager?"+c+"&op=list",function(i){if(i.success){for(var a in i.vehicles){var t=i.vehicles[a],s=t.unique_name;o[s]={info:{id:s,name:t.friendly_name,created_at:l(t.date_created).format("MMM DD YYYY @ hh:mm")},driving_data:[]},n(s)}e.refresh()}else console.error("failed to list vehicles:",i)}).fail(function(e,n,i){console.error("failed to send list vehicles request:",n,i)})},addVehicle:function(e,i){s.get("/fleetmanager?"+c+"&op=add&vehicle_id="+(e.id||"")+"&vehicle_name="+(e.name||""),function(e){if(e.success){var a={info:{created_at:l(e.vehicle.date_created).format("MMM DD YYYY @ hh:mm"),id:e.vehicle.unique_name,name:e.vehicle.friendly_name,key:e.key.sid,secret:e.key.secret},driving_data:[]};o[e.vehicle.unique_name]=a,n(e.vehicle.unique_name),i(null,a)}else i(e)}).fail(function(e,n,i){console.error("failed to send add vehicle request:",n,i)})},deleteVehicle:function(n){s.get("/fleetmanager?"+c+"&op=delete&vehicle_id="+n,function(i){i.success?(delete o[n],e.refresh()):console.error("failed to delete vehicle",i)}).fail(function(e,n,i){console.error("failed to send delete vehicle request:",n,i)})},generateKey:function(n){s.get("/fleetmanager?"+c+"&op=genkey&vehicle_id="+n,function(i){i.success?(o[n].info.key=i.key.sid,o[n].info.secret=i.key.secret,e.refresh()):console.error("failed to generate key",i)}).fail(function(e,n,i){console.error("failed to send generate key request:",n,i)})},init:function(){var e=this;this.updateToken(function(n){a=new d(n),e.refreshVehicleList()})}}}},127:function(e,n,i){i(162);var l,a,t=i(6),s={init:function(){l={},a={}},onVehicleData:function(e,n){if(!a[e.info.id]){var i="map-"+e.info.id,s=t.initMapElement(i);l[e.info.id]=s,a[e.info.id]={}}var d=l[e.info.id],c=a[e.info.id];t.addDataToMap(d,c,n)},onVehicleStats:function(e,n){if(n){var i="vehicle"+e.info.id;t.updateStats(i,n)}}};e.exports=s},128:function(e,n,i){i(164);var l=i(1),a={init:function(){l(".add-vehicle-show").click(function(){l(this).hide(),l(".add-vehicle").fadeIn(333),l("#id").val(""),l("#name").val(""),l("#sim_sid").val("")}),l(".add-vehicle-cancel").click(function(){l(".add-vehicle").hide(),l(".add-vehicle-show").fadeIn(333)})},onVehicleAddingFailed:function(e){l("#add-vehicle-failed").text(JSON.stringify(e))},onVehicleAdded:function(){l(".add-vehicle").hide(),l(".add-vehicle-show").fadeIn(333)}};e.exports=a},130:function(e,n,i){e.exports=i.p+"index.html"},131:function(e,n){e.exports=angular},132:function(e,n){e.exports=void 0},133:function(e,n,i){"use strict";function l(e){e.info.id in v||(v[e.info.id]=0,h[e.info.id]=0,p[e.info.id]=0)}function a(e,n){l(e);var i=++v[e.info.id],a=h[e.info.id],t=p[e.info.id],s={miles:n.miles.toFixed(0),avg_speed:(a/i).toFixed(0),driver_score:(t/i).toFixed(0),fuel:n.fuel.toFixed(0),brake:n.brake.toFixed(0),runtime:n.runtime};h[e.info.id]=h[e.info.id]+n.speed,p[e.info.id]=p[e.info.id]+n.avgT,f=s}var t=i(131);i(132),i(3),i(4),i(130);var s,d,c=i(127),o=i(6),r=i(128),v={},h={},p={},f=null,App=i(126);window.app=new App({refresh:function(){d.$apply()},onVehicleData:function(e,n){a(e,n),s.onVehicleData&&s.onVehicleData(e,n),s.onVehicleStats&&s.onVehicleStats(e,f)}}),t.module("app",["ngRoute"]).controller("DashboardViewCtrl",["$scope","$timeout",function(e,n){d=e,e.vehicles=app.vehicles,s=c,c.init(),n(function(){for(var n in e.vehicles){var i=e.vehicles[n];i.driving_data.forEach(function(e){c.onVehicleData(i,e)}),c.onVehicleStats(i,f)}},0)}]).controller("VehicleViewCtrl",["$routeParams","$scope","$timeout",function(e,n,i){d=n,n.vehicles=app.vehicles,n.id=e.id;var l=app.vehicles[e.id];s=o,o.init(),l&&i(function(){l.driving_data.forEach(function(e){o.onVehicleData(l.info.id,e)}),o.onVehicleStats(l,f)},0)}]).controller("VehicleListViewCtrl",["$scope","$timeout",function(e,n){d=e,e.vehicles=app.vehicles,e.newVehicle={},e.addVehicle=function(){app.addVehicle(t.copy(e.newVehicle),function(n,i){n?r.onVehicleAddingFailed(n):(e.vehicleAdded=i,r.onVehicleAdded(),e.$apply())})},e.deleteVehicle=function(e){app.deleteVehicle(e)},e.generateVehicleKey=function(e){app.generateKey(e)},s=r,r.init()}]).config(["$routeProvider",function(e){e.when("/dashboard",{controller:"DashboardViewCtrl",templateUrl:"views/dashboard.html"}).when("/vehicles/:id",{controller:"VehicleViewCtrl",templateUrl:"views/vehicle.html"}).when("/vehicles",{controller:"VehicleListViewCtrl",templateUrl:"views/vehicle_list.html"}).otherwise({redirectTo:"/dashboard"})}])},162:function(e,n){var i="views/dashboard.html";window.angular.module("ng").run(["$templateCache",function(e){e.put(i,'<h1>Active Vehicles</h1>\n\n<h3 ng-hide="vehicles.length" class="ng-hide">There are currently no vehicles on the road.</h3>\n\n<div ng-repeat="vehicle in vehicles" class="jumbotron vehicle vehicle{{vehicle.info.id}}">\n  <h3>{{ vehicle.info.id }} | {{vehicle.info.name}} <a href="#!/vehicles/{{vehicle.info.id}}">(view past drives)</a></h3>\n  <h4>Current trip time: <span class="runtime">0</span></h4>\n  <div class="row map-cont">\n    <div class="col-lg-12">\n      <div class="map" id="map-{{vehicle.info.id}}"></div>\n    </div>\n  </div>\n  <div class="row">\n    <div class="col-lg-2 col-lg-offset-1">\n      <div class="panel panel-info">\n        <div class="panel-heading">\n          <h3 class="panel-title">Trip Distance</h3>\n        </div>\n        <div class="panel-body miles">\n          <span>00</span> miles\n        </div>\n      </div>\n    </div>\n    <div class="col-lg-2">\n      <div class="panel panel-success">\n        <div class="panel-heading">\n          <h3 class="panel-title">Average Speed</h3>\n        </div>\n        <div class="panel-body speed">\n          <span>00</span> mph\n        </div>\n      </div>\n    </div>\n    <div class="col-lg-2">\n      <div class="panel panel-danger">\n        <div class="panel-heading">\n          <h3 class="panel-title">Hard Brakes</h3>\n        </div>\n        <div class="panel-body brake">\n          <span>00</span>\n        </div>\n      </div>\n    </div>\n    <div class="col-lg-2">\n      <div class="panel panel-warning">\n        <div class="panel-heading">\n          <h3 class="panel-title">Driver Score</h3>\n        </div>\n        <div class="panel-body driver_score">\n          <span>00</span>\n        </div>\n      </div>\n    </div>\n    <div class="col-lg-2">\n      <div class="panel panel-danger">\n        <div class="panel-heading">\n          <h3 class="panel-title">Fuel Guage</h3>\n        </div>\n        <div class="panel-body fuel">\n          <span>00</span>%\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n')}]),e.exports=i},163:function(e,n){var i="views/vehicle.html";window.angular.module("ng").run(["$templateCache",function(e){e.put(i,'<div class="jumbotron vehicle ">\n  <h3>{{vehicles[id].info.name}}</h3>\n  <h4>Total trip time: <span class="runtime">0</span></h4>\n  <div class="row map-cont">\n    <div class="col-lg-12">\n      <div class="map" id="map"></div>\n    </div>\n  </div>\n  <div class="row">\n    <div class="col-lg-2 col-lg-offset-1">\n      <div class="panel panel-info">\n        <div class="panel-heading">\n          <h3 class="panel-title">Trip Distance</h3>\n        </div>\n        <div class="panel-body miles">\n          <span>00</span> miles\n        </div>\n      </div>\n    </div>\n    <div class="col-lg-2">\n      <div class="panel panel-success">\n        <div class="panel-heading">\n          <h3 class="panel-title">Average Speed</h3>\n        </div>\n        <div class="panel-body speed">\n          <span>00</span> mph\n        </div>\n      </div>\n    </div>\n    <div class="col-lg-2">\n      <div class="panel panel-danger">\n        <div class="panel-heading">\n          <h3 class="panel-title">Hard Brakes</h3>\n        </div>\n        <div class="panel-body brake">\n          <span>00</span>\n        </div>\n      </div>\n    </div>\n    <div class="col-lg-2">\n      <div class="panel panel-warning">\n        <div class="panel-heading">\n          <h3 class="panel-title">Driver Score</h3>\n        </div>\n        <div class="panel-body driver_score">\n          <span>00</span>\n        </div>\n      </div>\n    </div>\n    <div class="col-lg-2">\n      <div class="panel panel-danger">\n        <div class="panel-heading">\n          <h3 class="panel-title">Fuel Guage</h3>\n        </div>\n        <div class="panel-body fuel">\n          <span>00</span>%\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n')}]),e.exports=i},164:function(e,n){var i="views/vehicle_list.html";window.angular.module("ng").run(["$templateCache",function(e){e.put(i,'<div class="row">\n  <div class="col-lg-12">\n    <div class="page-header">\n      <h1 id="tables">Vehicles</h1>\n    </div>\n    <div class="bs-component">\n      <table class="table table-striped table-hover ">\n        <thead>\n          <tr>\n            <th>Id</th>\n            <th>Name</th>\n\x3c!--\n            <th>Twilio SIM SID</th>\n--\x3e\n            <th>Key</th>\n            <th>Created</th>\n            <th>Operations</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr ng-repeat="vehicle in vehicles" class="jumbotron vehicle vehicle{{vehicle.info.id}}" ng-class="{\'text-success\': vehicleAdded.info.id === vehicle.info.id}">\n            <td>{{ vehicle.info.id }}</td>\n            <td>{{ vehicle.info.name }}</td>\n\x3c!--\n            <td>{{ vehicle.info.sim_sid }}</td>\n            <td>{{ vehicle.info.key }} <small ng-if="vehicle.info.secret" class="text-warning"><br/>Secret: {{ vehicle.info.secret }}</small></td>\n--\x3e\n            <td>\n              <div ng-if="vehicle.info.key">{{ vehicle.info.key }} <small class="text-warning"><br/>Secret: {{ vehicle.info.secret }}</small></div>\n              <div ng-if="!vehicle.info.key" class="text-danger">Hidden</div>\n            </td>\n            <td>{{ vehicle.info.created_at }}</td>\n\x3c!--\n            <td><a href="#!/vehicles/{{ vehicle.info.id }}/edit" class="btn btn-xs btn-success">Edit</a></td>\n--\x3e\n            <td>\n              <button ng-click="generateVehicleKey(vehicle.info.id)" class="btn btn-xs btn-danger">Generate New Key</button>\n              <button ng-click="deleteVehicle(vehicle.info.id)" class="btn btn-xs btn-danger">Delete</button>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    <div id="source-button" class="btn btn-primary btn-xs" style="display: none;">&lt; &gt;</div></div>\n  </div>\n  <div class="divider col-lg-10 bg-primary"></div>\n</div>\n\n<a class="btn btn-primary add-vehicle-show">Add New Vehicle</a>\n\n<div class="row add-vehicle">\n  <div class="col-lg-6">\n    <form class="form-horizontal" ng-submit="addVehicle()">\n      <fieldset>\n        <legend>New Vehicle</legend>\n        <div class="form-group">\n          <label for="id" class="col-lg-2 control-label">Id</label>\n          <div class="col-lg-10">\n            <input type="text" class="form-control" ng-model="newVehicle.id" id="id" placeholder="Id">\n          </div>\n        </div>\n\n        <div class="form-group">\n          <label for="name" class="col-lg-2 control-label">Name</label>\n          <div class="col-lg-10">\n            <input type="text" class="form-control" ng-model="newVehicle.name" id="name" placeholder="Name">\n          </div>\n        </div>\n\n\x3c!--\n        <div class="form-group">\n          <label for="sim_sid" class="col-lg-2 control-label">Twilio SIM SID</label>\n          <div class="col-lg-10">\n            <input type="text" class="form-control" ng-model="newVehicle.sim_sid" id="sim_sid" placeholder="Twilio SIM SID">\n          </div>\n        </div>\n--\x3e\n\n        <div class="form-group">\n          <div class="col-lg-10 col-lg-offset-2">\n            <button type="submit" class="btn btn-primary">Submit</button>\n            <button type="reset" class="btn btn-default add-vehicle-cancel">Cancel</button>\n          </div>\n        </div>\n\n        <p class="text-warning" id="add-vehicle-failed"></p>\n      </fieldset>\n    </form>\n  </div>\n</div>\n')}]),e.exports=i},169:function(e,n){e.exports=Twilio.Sync},6:function(e,n,i){i(163);var l,a=i(1),t={},s={initMapElement:function(e){return new google.maps.Map(document.getElementById(e),{zoom:14})},addDataToMap:function(e,n,i){var l={lat:i.lat,lng:i.lon||0},a=new google.maps.Marker({position:l,map:e,title:String(i.id)}),t='<div class="infowindow-label">                             <h1>Point data</h1>                             <p><span class="label label-default">Distance:</span> <span class="value">'+i.miles.toFixed(0)+' Miles</span></p>                             <p><span class="label label-default">Speed:</span> <span class="value">'+i.speed.toFixed(0)+' mph</span></p>                             <p><span class="label label-default">Fuel:</span> <span class="value">'+i.fuel.toFixed(0)+"%</span></p>                           </div>",s=new google.maps.InfoWindow({content:t});n[i.id]=s,e.panTo(a.getPosition()),google.maps.event.addListener(a,"click",function(i){current_infowindow&&current_infowindow.close(),n[this.getTitle()].open(e,this),current_infowindow=n[this.getTitle()]})},updateStats:function(e,n){if(n){a("."+e+" .miles span").text(n.miles),a("."+e+" .speed span").text(n.avg_speed),a("."+e+" .driver_score span").text(100-n.driver_score),a("."+e+" .fuel span").text(n.fuel),a("."+e+" .brake span").text(n.brake);var i;if(n.runtime<60)i=n.runtime+" seconds";else if(n.runtime<3600)i=(n.runtime/60).toFixed(0)+" minutes";else{var l=Math.floor(runtime/3600),t=((runtime-3600*l)/60).toFixed(0);i=l+" hours and "+t+" minutes"}a("."+e+" .runtime").text(i)}},init:function(){l=s.initMapElement("map")},onVehicleData:function(e,n){s.addDataToMap(l,t,n)},onVehicleStats:function(e,n){s.updateStats("vehicle",n)}};e.exports=s}},[133]);
//# sourceMappingURL=index.js.map